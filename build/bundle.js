(()=>{var t={10:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var i=n(537),s=n.n(i),r=n(645),l=n.n(r)()(s());l.push([t.id,".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n","",{version:3,sources:["webpack://./src/framework/view/abstract-view.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,WAAW;AACb;;AAEA;EACE;;IAEE,wBAAwB;EAC1B;;EAEA;;;;;IAKE,2BAA2B;EAC7B;;EAEA;;;;IAIE,0BAA0B;EAC5B;AACF",sourcesContent:[".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n"],sourceRoot:""}]);const o=l},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,s,r){"string"==typeof t&&(t=[[null,t,void 0]]);var l={};if(i)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(l[a]=!0)}for(var c=0;c<t.length;c++){var m=[].concat(t[c]);i&&l[m[0]]||(void 0!==r&&(void 0===m[5]||(m[1]="@layer".concat(m[5].length>0?" ".concat(m[5]):""," {").concat(m[1],"}")),m[5]=r),n&&(m[2]?(m[1]="@media ".concat(m[2]," {").concat(m[1],"}"),m[2]=n):m[2]=n),s&&(m[4]?(m[1]="@supports (".concat(m[4],") {").concat(m[1],"}"),m[4]=s):m[4]="".concat(s)),e.push(m))}},e}},537:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),r="/*# ".concat(s," */"),l=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(l).concat([r]).join("\n")}return[e].join("\n")}},484:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,n="millisecond",i="second",s="minute",r="hour",l="day",o="week",a="month",c="quarter",m="year",d="date",h="Invalid Date",u=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},_=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},v={s:_,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return(e<=0?"+":"-")+_(i,2,"0")+":"+_(s,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var i=12*(n.year()-e.year())+(n.month()-e.month()),s=e.clone().add(i,a),r=n-s<0,l=e.clone().add(i+(r?-1:1),a);return+(-(i+(n-s)/(r?s-l:l-s))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:a,y:m,w:o,d:l,D:d,h:r,m:s,s:i,ms:n,Q:c}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},C="en",y={};y[C]=p;var g=function(t){return t instanceof b},w=function t(e,n,i){var s;if(!e)return C;if("string"==typeof e){var r=e.toLowerCase();y[r]&&(s=r),n&&(y[r]=n,s=r);var l=e.split("-");if(!s&&l.length>1)return t(l[0])}else{var o=e.name;y[o]=e,s=o}return!i&&s&&(C=s),s||!i&&C},$=function(t,e){if(g(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new b(n)},M=v;M.l=w,M.i=g,M.w=function(t,e){return $(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var b=function(){function p(t){this.$L=w(t.locale,null,!0),this.parse(t)}var _=p.prototype;return _.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(M.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(u);if(i){var s=i[2]-1||0,r=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)):new Date(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},_.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},_.$utils=function(){return M},_.isValid=function(){return!(this.$d.toString()===h)},_.isSame=function(t,e){var n=$(t);return this.startOf(e)<=n&&n<=this.endOf(e)},_.isAfter=function(t,e){return $(t)<this.startOf(e)},_.isBefore=function(t,e){return this.endOf(e)<$(t)},_.$g=function(t,e,n){return M.u(t)?this[e]:this.set(n,t)},_.unix=function(){return Math.floor(this.valueOf()/1e3)},_.valueOf=function(){return this.$d.getTime()},_.startOf=function(t,e){var n=this,c=!!M.u(e)||e,h=M.p(t),u=function(t,e){var i=M.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return c?i:i.endOf(l)},f=function(t,e){return M.w(n.toDate()[t].apply(n.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},p=this.$W,_=this.$M,v=this.$D,C="set"+(this.$u?"UTC":"");switch(h){case m:return c?u(1,0):u(31,11);case a:return c?u(1,_):u(0,_+1);case o:var y=this.$locale().weekStart||0,g=(p<y?p+7:p)-y;return u(c?v-g:v+(6-g),_);case l:case d:return f(C+"Hours",0);case r:return f(C+"Minutes",1);case s:return f(C+"Seconds",2);case i:return f(C+"Milliseconds",3);default:return this.clone()}},_.endOf=function(t){return this.startOf(t,!1)},_.$set=function(t,e){var o,c=M.p(t),h="set"+(this.$u?"UTC":""),u=(o={},o[l]=h+"Date",o[d]=h+"Date",o[a]=h+"Month",o[m]=h+"FullYear",o[r]=h+"Hours",o[s]=h+"Minutes",o[i]=h+"Seconds",o[n]=h+"Milliseconds",o)[c],f=c===l?this.$D+(e-this.$W):e;if(c===a||c===m){var p=this.clone().set(d,1);p.$d[u](f),p.init(),this.$d=p.set(d,Math.min(this.$D,p.daysInMonth())).$d}else u&&this.$d[u](f);return this.init(),this},_.set=function(t,e){return this.clone().$set(t,e)},_.get=function(t){return this[M.p(t)]()},_.add=function(n,c){var d,h=this;n=Number(n);var u=M.p(c),f=function(t){var e=$(h);return M.w(e.date(e.date()+Math.round(t*n)),h)};if(u===a)return this.set(a,this.$M+n);if(u===m)return this.set(m,this.$y+n);if(u===l)return f(1);if(u===o)return f(7);var p=(d={},d[s]=t,d[r]=e,d[i]=1e3,d)[u]||1,_=this.$d.getTime()+n*p;return M.w(_,this)},_.subtract=function(t,e){return this.add(-1*t,e)},_.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var i=t||"YYYY-MM-DDTHH:mm:ssZ",s=M.z(this),r=this.$H,l=this.$m,o=this.$M,a=n.weekdays,c=n.months,m=function(t,n,s,r){return t&&(t[n]||t(e,i))||s[n].slice(0,r)},d=function(t){return M.s(r%12||12,t,"0")},u=n.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:M.s(o+1,2,"0"),MMM:m(n.monthsShort,o,c,3),MMMM:m(c,o),D:this.$D,DD:M.s(this.$D,2,"0"),d:String(this.$W),dd:m(n.weekdaysMin,this.$W,a,2),ddd:m(n.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(r),HH:M.s(r,2,"0"),h:d(1),hh:d(2),a:u(r,l,!0),A:u(r,l,!1),m:String(l),mm:M.s(l,2,"0"),s:String(this.$s),ss:M.s(this.$s,2,"0"),SSS:M.s(this.$ms,3,"0"),Z:s};return i.replace(f,(function(t,e){return e||p[t]||s.replace(":","")}))},_.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},_.diff=function(n,d,h){var u,f=M.p(d),p=$(n),_=(p.utcOffset()-this.utcOffset())*t,v=this-p,C=M.m(this,p);return C=(u={},u[m]=C/12,u[a]=C,u[c]=C/3,u[o]=(v-_)/6048e5,u[l]=(v-_)/864e5,u[r]=v/e,u[s]=v/t,u[i]=v/1e3,u)[f]||v,h?C:M.a(C)},_.daysInMonth=function(){return this.endOf(a).$D},_.$locale=function(){return y[this.$L]},_.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=w(t,e,!0);return i&&(n.$L=i),n},_.clone=function(){return M.w(this.$d,this)},_.toDate=function(){return new Date(this.valueOf())},_.toJSON=function(){return this.isValid()?this.toISOString():null},_.toISOString=function(){return this.$d.toISOString()},_.toString=function(){return this.$d.toUTCString()},p}(),S=b.prototype;return $.prototype=S,[["$ms",n],["$s",i],["$m",s],["$H",r],["$W",l],["$M",a],["$y",m],["$D",d]].forEach((function(t){S[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),$.extend=function(t,e){return t.$i||(t(e,b,$),t.$i=!0),$},$.locale=w,$.isDayjs=g,$.unix=function(t){return $(1e3*t)},$.en=y[C],$.Ls=y,$.p={},$}()},110:function(t){t.exports=function(){"use strict";return function(t,e,n){t=t||{};var i=e.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function r(t,e,n,s){return i.fromToBase(t,e,n,s)}n.en.relativeTime=s,i.fromToBase=function(e,i,r,l,o){for(var a,c,m,d=r.$locale().relativeTime||s,h=t.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],u=h.length,f=0;f<u;f+=1){var p=h[f];p.d&&(a=l?n(e).diff(r,p.d,!0):r.diff(e,p.d,!0));var _=(t.rounding||Math.round)(Math.abs(a));if(m=a>0,_<=p.r||!p.r){_<=1&&f>0&&(p=h[f-1]);var v=d[p.l];o&&(_=o(""+_)),c="string"==typeof v?v.replace("%d",_):v(_,i,p.l,m);break}}if(i)return c;var C=m?d.future:d.past;return"function"==typeof C?C(c):C.replace("%s",c)},i.to=function(t,e){return r(t,e,this,!0)},i.from=function(t,e){return r(t,e,this)};var l=function(t){return t.$u?n.utc():n()};i.toNow=function(t){return this.to(l(this),t)},i.fromNow=function(t){return this.from(l(this),t)}}}()},379:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var r={},l=[],o=0;o<t.length;o++){var a=t[o],c=i.base?a[0]+i.base:a[0],m=r[c]||0,d="".concat(c," ").concat(m);r[c]=m+1;var h=n(d),u={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==h)e[h].references++,e[h].updater(u);else{var f=s(u,i);i.byIndex=o,e.splice(o,0,{identifier:d,updater:f,references:1})}l.push(d)}return l}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var r=i(t=t||[],s=s||{});return function(t){t=t||[];for(var l=0;l<r.length;l++){var o=n(r[l]);e[o].references--}for(var a=i(t,s),c=0;c<r.length;c++){var m=n(r[c]);0===e[m].references&&(e[m].updater(),e.splice(m,1))}r=a}}},569:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={id:i,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{"use strict";var t=n(379),e=n.n(t),i=n(795),s=n.n(i),r=n(569),l=n.n(r),o=n(565),a=n.n(o),c=n(216),m=n.n(c),d=n(589),h=n.n(d),u=n(10),f={};f.styleTagTransform=h(),f.setAttributes=a(),f.insert=l().bind(null,"head"),f.domAPI=s(),f.insertStyleElement=m(),e()(u.Z,f),u.Z&&u.Z.locals&&u.Z.locals;const p="shake";class _{#t=null;_callback={};constructor(){if(new.target===_)throw new Error("Can't instantiate AbstractView, only concrete one.")}get element(){return this.#t||(this.#t=function(t){const e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}(this.template)),this.#t}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#t=null}shake(t){this.element.classList.add(p),setTimeout((()=>{this.element.classList.remove(p),t?.()}),600)}}const v="beforeend";function C(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;if(!(t instanceof _))throw new Error("Can render only components");if(null===e)throw new Error("Container element doesn't exist");e.insertAdjacentElement(n,t.element)}function y(t,e){if(!(t instanceof _&&e instanceof _))throw new Error("Can replace only components");const n=t.element,i=e.element,s=i.parentElement;if(null===s)throw new Error("Parent element doesn't exist");s.replaceChild(n,i)}function g(t){if(null!==t){if(!(t instanceof _))throw new Error("Can remove only components");t.element.remove(),t.removeElement()}}const w="UPDATE_FILM",$="ADD_FILM",M="DELETE_FILM",b="PATCH",S="MINOR",T="MAJOR",E="INIT",k="all",A="default",D="date",F="rating",L=["smile","sleeping","puke","angry"],x="YYYY";var P=n(484),B=n.n(P);const H=(t,e)=>t?B()(t).format(e):"",I=t=>{const e=Math.trunc(t/60);return`${e}h ${t-60*e}m`};class j extends _{get template(){return'<section class="films"></section>'}}class O extends _{get template(){return'<div class="films-list__container"></div>'}}class R extends _{get template(){return'<section class="films-list"></section>'}}class Y extends _{#e=null;#n=null;constructor(t){let{onSortTypeChange:e,currentSortType:n}=t;super(),this.#e=e,this.#n=n,this.element.addEventListener("click",this.#i)}get template(){return`<ul class="sort">\n      <li>\n        <a href="#" class="sort__button ${(t=this.#n)===A?"sort__button--active":""}" data-sort-type="${A}">\n          Sort by default\n        </a>\n      </li>\n      <li>\n        <a href="#" class="sort__button ${t===D?"sort__button--active":""}" data-sort-type="${D}">\n          Sort by date\n        </a>\n      </li>\n      <li>\n        <a href="#" class="sort__button ${t===F?"sort__button--active":""}" data-sort-type="${F}">\n          Sort by rating\n        </a>\n      </li>\n   </ul>`;var t}#i=t=>{t.preventDefault(),t.target.classList.contains("sort__button")&&!t.target.classList.contains("sort__button--active")&&this.#e(t.target,t.target.dataset.sortType)}}class U extends _{#s=null;constructor(t){let{onClick:e}=t;super(),this.#s=e,this.element.addEventListener("click",this.#r)}get template(){return'<button class="films-list__show-more">Show more</button>'}#r=t=>{t.preventDefault(),this.#s()}}class W extends _{#l=null;#o=null;#a=null;constructor(t){let{filters:e,currentFilterType:n,onFilterTypeChange:i}=t;super(),this.#l=e,this.#o=n,this.#a=i,this.element.addEventListener("click",this.#c)}get template(){return t=this.#l,e=this.#o,`<nav class="main-navigation">\n      <a href="#all" data-filter-type="${k}"\n      class="main-navigation__item ${e===k?"main-navigation__item--active":""}">\n        All movies\n      </a>\n      ${Object.keys(t).slice(1).map((n=>`\n        ${((t,e)=>{const{type:n,name:i,filteredFilms:s}=t;return`\n    <a href="#${n}" data-filter-type="${n}"\n    class="main-navigation__item ${n===e?"main-navigation__item--active":""}">\n      ${i}\n      <span class="main-navigation__item-count">${s.length}</span>\n    </a>\n    `})(t[n],e)}\n      `)).join("")}\n   </nav>`;var t,e}#c=t=>{t.preventDefault();const e=t.target.closest(".main-navigation__item");e&&!e.classList.contains("main-navigation__item--active")&&this.#a(e.dataset.filterType)}}class N{#m=null;#d=null;#h=null;#u=null;constructor(t){let{filtersContainer:e,filterModel:n,filmsModel:i}=t;this.#m=e,this.#d=n,this.#h=i,this.#h.addObserver(this.#f),this.#d.addObserver(this.#f)}get filters(){const t=this.#h.films,e={all:{type:k,name:"All movies",emptyFilmsMessage:"There are no movies in our database",filteredFilms:[...t]},watchlist:{type:"watchlist",name:"Watchlist",emptyFilmsMessage:"There are no movies to watch now",filteredFilms:[]},history:{type:"history",name:"History",emptyFilmsMessage:"There are no watched movies now",filteredFilms:[]},favorites:{type:"favorites",name:"Favorites",emptyFilmsMessage:"There are no favorite movies now",filteredFilms:[]}};return t.forEach((t=>{t.userDetails.watchlist&&e.watchlist.filteredFilms.push(t),t.userDetails.alreadyWatched&&e.history.filteredFilms.push(t),t.userDetails.favorite&&e.favorites.filteredFilms.push(t)})),e}init(){const t=this.filters,e=this.#u;this.#u=new W({filters:t,currentFilterType:this.#d.filter,onFilterTypeChange:this.#a}),null!==e?(y(this.#u,e),g(e)):C(this.#u,this.#m)}#f=()=>{this.init()};#a=t=>{this.#d.filter!==t&&this.#d.setFilter(T,t)}}class q extends _{#p=null;#s=null;#_=null;constructor(t){let{film:e,onClick:n,onControlBtnClick:i}=t;super(),this.#p=e,this.#s=n,this.#_=i,this.element.querySelector(".film-card__link").addEventListener("click",this.#r),this.element.querySelector(".film-card__controls").addEventListener("click",this.#v)}get template(){return(t=>{const{comments:e}=t,{title:n,totalRating:i,poster:s,duration:r,description:l}=t.filmInfo,o=t.filmInfo.genre.join(", "),{alreadyWatched:a,favorite:c,watchlist:m}=t.userDetails,{date:d}=t.filmInfo.release;return`<article class="film-card">\n      <a class="film-card__link">\n        <h3 class="film-card__title">${n}</h3>\n        <p class="film-card__rating">${i}</p>\n        <p class="film-card__info">\n          <span class="film-card__year">${H(d,x)}</span>\n          <span class="film-card__duration">${I(r)}</span>\n          <span class="film-card__genre">${o}</span>\n        </p>\n        <img src="${s}" alt="" class="film-card__poster">\n        <p class="film-card__description">${l.length>139?`${l.slice(0,139)}...`:l}</p>\n        <span class="film-card__comments">${e.length}</span>\n      </a>\n      <div class="film-card__controls">\n        <button class="film-card__controls-item film-card__controls-item--add-to-watchlist ${m?"film-card__controls-item--active":""}" data-user-detail="watchlist" type="button">Add to watchlist</button>\n        <button class="film-card__controls-item film-card__controls-item--mark-as-watched ${a?"film-card__controls-item--active":""}" data-user-detail="alreadyWatched" type="button">Mark as watched</button>\n        <button class="film-card__controls-item film-card__controls-item--favorite ${c?"film-card__controls-item--active":""}" data-user-detail="favorite" type="button">Mark as favorite</button>\n      </div>\n    </article>`})(this.#p)}#r=()=>{this.#s()};#v=t=>{t.target.classList.contains("film-card__controls-item")&&this.#_({...this.#p,userDetails:{...this.#p.userDetails,[t.target.dataset.userDetail]:!this.#p.userDetails[t.target.dataset.userDetail]}})}}class J extends _{_state={};updateElement(t){t&&(this._setState(t),this.#C())}_restoreHandlers(){throw new Error("Abstract method not implemented: restoreHandlers")}_setState(t){this._state=structuredClone({...this._state,...t})}#C(){const t=this.element,e=t.parentElement;this.removeElement();const n=this.element;e.replaceChild(n,t),this._restoreHandlers()}}var Z=n(110),z=n.n(Z);const K=t=>{const{filmInfo:e,userDetails:n,comments:i,commentEmoji:s,commentText:r}=t,l=(t=>{const{title:e,alternativeTitle:n,totalRating:i,poster:s,ageRating:r,director:l,writers:o,actors:a,duration:c,genre:m,description:d,release:h}=t,u=H(t.release.date,"D MMM YYYY");return`\n      <div class="film-details__poster">\n        <img class="film-details__poster-img" src="${s}" alt="">\n        <p class="film-details__age">${r}+</p>\n      </div>\n      <div class="film-details__info">\n        <div class="film-details__info-head">\n          <div class="film-details__title-wrap">\n            <h3 class="film-details__title">${e}</h3>\n            <p class="film-details__title-original">${n}</p>\n          </div>\n          <div class="film-details__rating">\n            <p class="film-details__total-rating">${i}</p>\n          </div>\n        </div>\n        <table class="film-details__table">\n          <tr class="film-details__row">\n            <td class="film-details__term">Director</td>\n            <td class="film-details__cell">${l}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Writers</td>\n            <td class="film-details__cell">${o.join(", ")}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Actors</td>\n            <td class="film-details__cell">${a.join(", ")}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Release Date</td>\n            <td class="film-details__cell">${u}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Duration</td>\n            <td class="film-details__cell">${I(c)}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Country</td>\n            <td class="film-details__cell">${h.releaseCountry}</td>\n          </tr>\n          <tr class="film-details__row">\n            <td class="film-details__term">Genres</td>\n            <td class="film-details__cell">\n              <span class="film-details__genre">${f=m,f.map((t=>`<span class="film-details__genre">${t}</span>`)).join("")}</span>\n          </td>\n          </tr>\n        </table>\n        <p class="film-details__film-description">\n          ${d}\n        </p>\n      </div>\n    `;var f})(e),o=(t=>{const{alreadyWatched:e,favorite:n,watchlist:i}=t;return`\n  <button type="button"\n  class="film-details__control-button film-details__control-button--watchlist ${i?"film-details__control-button--active":""}"\n  id="watchlist" name="watchlist" data-user-detail="watchlist">Add to watchlist</button>\n  <button type="button"\n  class="film-details__control-button film-details__control-button--watched ${e?"film-details__control-button--active":""}"\n  id="watched" name="watched" data-user-detail="alreadyWatched">Already watched</button>\n  <button type="button"\n  class="film-details__control-button film-details__control-button--favorite ${n?"film-details__control-button--active":""}"\n  id="favorite" name="favorite" data-user-detail="favorite">Add to favorites</button>\n  `})(n),a=(t=>`\n    <h3 class="film-details__comments-title">Comments <span class="film-details__comments-count">${t.length}</span></h3>\n    <ul class="film-details__comments-list">\n      ${t.map((t=>{return`\n      <li class="film-details__comment">\n      <span class="film-details__comment-emoji">\n        <img src="./images/emoji/${t.emotion}.png" width="55" height="55" alt="emoji-${t.emotion}">\n      </span>\n      <div>\n        <p class="film-details__comment-text">${t.comment}</p>\n        <p class="film-details__comment-info">\n          <span class="film-details__comment-author">${t.author}</span>\n          <span class="film-details__comment-day">${e=t.date,B()(e).format("YYYY/M/D H:m")}</span>\n          <button class="film-details__comment-delete" data-id="${t.id}">Delete</button>\n        </p>\n      </div>\n    </li>\n      `;var e})).join("")}\n    </ul>\n`)(i),c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return`\n    <div class="film-details__add-emoji-label">\n      <img src="./images/emoji/${t}.png" width="30" height="30" alt="emoji">\n    </div>\n    <label class="film-details__comment-label">\n      <textarea class="film-details__comment-input" placeholder="Select reaction below and write comment here"\n        name="comment">${e}</textarea>\n    </label>\n    <div class="film-details__emoji-list">\n      ${L.map((e=>`\n        <input class="film-details__emoji-item visually-hidden" name="comment-emoji" type="radio" id="emoji-${e}"\n          value="${e}" ${e===t?"checked":""}>\n        <label class="film-details__emoji-label" for="emoji-${e}">\n          <img src="./images/emoji/${e}.png" width="30" height="30" alt="emoji">\n        </label>\n      `)).join("")}\n    </div>\n`}(s,r);return`<section class="film-details">\n      <div class="film-details__inner">\n        <div class="film-details__top-container">\n          <div class="film-details__close">\n            <button class="film-details__close-btn" type="button">close</button>\n          </div>\n          <div class="film-details__info-wrap">\n            ${l}\n          </div>\n          <section class="film-details__controls">\n            ${o}\n          </section>\n        </div>\n        <div class="film-details__bottom-container">\n          <section class="film-details__comments-wrap">\n            ${a}\n            <form class="film-details__new-comment" action="" method="get">\n              ${c}\n            </form>\n          </section>\n        </div>\n      </div>\n    </section>`};B().extend(z());class V extends J{#y=null;#_=null;#g=null;#w=null;static#$=L[0];constructor(t){let{film:e,onCloseClick:n,onControlBtnClick:i,onAddComment:s,onDeleteComment:r}=t;super(),this._setState(V.parseFilmToState(e)),this.#y=n,this.#_=i,this.#g=s,this.#w=r,this._restoreHandlers()}get template(){return K(this._state)}_restoreHandlers(){const t=this.element.querySelector(".film-details__comment-input");this.element.querySelector(".film-details__close-btn").addEventListener("click",this.#M),this.element.querySelector(".film-details__controls").addEventListener("click",this.#v),this.element.querySelector(".film-details__comments-list").addEventListener("click",this.#b),this.element.querySelector(".film-details__comment-input").addEventListener("keydown",this.#S),t.addEventListener("keydown",this.#S),t.addEventListener("input",this.#T),this.element.querySelector(".film-details__emoji-list").addEventListener("change",this.#E)}#M=()=>{this.#y()};#v=t=>{t.target.classList.contains("film-details__control-button")&&(this.updateElement({userDetails:{...this._state.userDetails,[t.target.dataset.userDetail]:!this._state.userDetails[t.target.dataset.userDetail]},scrollPosition:this.element.scrollTop}),this.#_(V.parseStateToFilm(this._state)),this.element.scrollTo(0,this._state.scrollPosition))};#S=t=>{if((t=>t.ctrlKey&&"Enter"===t.code)(t)){const t={id:Math.random().toString(),comment:this._state.commentText,emotion:this._state.commentEmoji};this.updateElement({comments:[...this._state.comments,t],scrollPosition:this.element.scrollTop}),this.#g({...V.parseStateToFilm(this._state),commentToAdd:t}),this.element.scrollTo(0,this._state.scrollPosition)}};#T=t=>{this._setState({commentText:t.target.value})};#b=t=>{if(t.target.classList.contains("film-details__comment-delete")){const e=this._state.comments.find((e=>e.id===t.target.dataset.id));this.updateElement({comments:this._state.comments.filter((e=>e.id!==t.target.dataset.id)),scrollPosition:this.element.scrollTop}),this.#w({...V.parseStateToFilm(this._state),commentToDelete:e}),this.element.scrollTo(0,this._state.scrollPosition)}};#E=t=>{this.updateElement({commentEmoji:t.target.value,commentText:this._state.commentText,scrollPosition:this.element.scrollTop}),this.element.scrollTo(0,this._state.scrollPosition)};static parseFilmToState(t){return{...t,commentEmoji:V.#$}}static parseStateToFilm(t){const e={...t};return delete e.scrollPosition,delete e.commentEmoji,delete e.commentText,e}}let X=null;class G{#k=null;#p=null;constructor(t){let{film:e,onControlBtnClick:n,onAddComment:i,onDeleteComment:s}=t;this.#p=e,this.#k=new V({film:this.#p,onCloseClick:this.#y,onControlBtnClick:n,onAddComment:i,onDeleteComment:s})}showPopup(){X&&X.closePopup(),document.body.classList.add("hide-overflow"),document.body.appendChild(this.#k.element),document.addEventListener("keydown",this.#A),X=this}closePopup(){document.body.classList.remove("hide-overflow"),document.body.removeChild(this.#k.element),document.removeEventListener("keydown",this.#A),X=null}#y=()=>{this.closePopup()};#A=t=>{(t=>"Escape"===t.code)(t)&&this.closePopup()}}class Q{#D=null;#F=null;#L=null;#x=null;constructor(t){let{filmListContainer:e,onDataChange:n}=t;this.#D=e,this.#F=n}init(t){this.#x=new G({film:t,onControlBtnClick:this.#P,onAddComment:this.#B,onDeleteComment:this.#H});const e=this.#L;this.#L=new q({film:t,onClick:this.#s,onControlBtnClick:this.#P}),null!==e?(y(this.#L,e),g(e)):C(this.#L,this.#D)}destroy(){g(this.#L)}#s=()=>{this.#x.showPopup()};#P=t=>{this.#F(w,S,t)};#B=t=>{this.#F($,b,t)};#H=t=>{this.#F(M,b,t)}}class tt extends _{get template(){return'<p class="films-list__no-films">Loading...</p>'}}class et extends _{#I;constructor(t){let{watchedFilmsCount:e}=t;super(),this.#I=e}get template(){return(t=>{const e=(t=>t?t<=10?"novice":t<=20?"fan":"movie buff":null)(t);return`\n    <section class="header__profile profile">\n      ${e?`<p class="profile__rating">${e}</p>`:""}\n      <img class="profile__avatar" src="images/bitmap@2x.png" alt="Avatar" width="35" height="35">\n    </section>\n  `})(this.#I)}}class nt extends _{#l=null;#j=null;constructor(t){let{filters:e,activeFilter:n}=t;super(),this.#l=e,this.#j=n}get template(){return`<h2 class="films-list__title">${this.#l[this.#j].emptyFilmsMessage}</h2>`}}const it=document.querySelector(".header");class st{#O=new Set;addObserver(t){this.#O.add(t)}removeObserver(t){this.#O.delete(t)}_notify(t,e){this.#O.forEach((n=>n(t,e)))}}class rt{constructor(t,e){this._endPoint=t,this._authorization=e}async _load(t){let{url:e,method:n="GET",body:i=null,headers:s=new Headers}=t;s.append("Authorization",this._authorization);const r=await fetch(`${this._endPoint}/${e}`,{method:n,body:i,headers:s});try{return rt.checkStatus(r),r}catch(t){rt.catchError(t)}}static parseResponse(t){return t.json()}static checkStatus(t){if(!t.ok)throw new Error(`${t.status}: ${t.statusText}`)}static catchError(t){throw t}}const lt="Basic SPMsk28493",ot="https://19.ecmascript.pages.academy/cinemaddict",at=document.querySelector(".main"),ct=new class extends st{#R=[];#Y;constructor(t){let{filmsApiService:e}=t;super(),this.#Y=e}get films(){return this.#R}async init(){try{const t=await this.#Y.films;this.#R=t.map(this.#U)}catch(t){this.#R=[]}this._notify(E,this.#R)}async updateFilm(t,e){const n=this.#R.findIndex((t=>t.id===e.id));if(-1===n)throw new Error("Can't update unexisting film");try{const i=await this.#Y.updateFilm(e),s=this.#U(i);this.#R=[...this.#R.slice(0,n),s,...this.#R.slice(n+1)],this._notify(t,s)}catch(t){throw new Error("Can't update film")}}#U(t){const e={id:t.id,comments:t.comments,filmInfo:{...t.film_info,ageRating:t.film_info.age_rating,alternativeTitle:t.film_info.alternative_title,totalRating:t.film_info.total_rating,release:{date:t.film_info.release.date,releaseCountry:t.film_info.release.release_country}},userDetails:{...t.user_details,alreadyWatched:t.user_details.already_watched,watchingDate:t.user_details.watching_date}};return delete e.filmInfo.age_rating,delete e.filmInfo.alternative_title,delete e.filmInfo.total_rating,delete e.userDetails.already_watched,delete e.userDetails.watching_date,e}}({filmsApiService:new class extends rt{get films(){return this._load({url:"movies"}).then(rt.parseResponse)}async updateFilm(t){const e=await this._load({url:`movies/${t.id}`,method:"PUT",body:JSON.stringify(this.#W(t)),headers:new Headers({"Content-Type":"application/json"})});return await rt.parseResponse(e)}#W(t){const e={id:t.id,comments:t.comments.map((t=>t.id)),film_info:{...t.filmInfo,age_rating:t.filmInfo.ageRating,alternative_title:t.filmInfo.alternativeTitle,total_rating:t.filmInfo.ageRating,release:{date:t.filmInfo.release.date,release_country:t.filmInfo.release.releaseCountry}},user_details:{...t.userDetails,already_watched:t.userDetails.alreadyWatched,watching_date:t.userDetails.watchingDate}};return delete e.film_info.ageRating,delete e.film_info.alternativeTitle,delete e.film_info.totalRating,delete e.user_details.alreadyWatched,delete e.user_details.watchingDate,e}}(ot,lt)}),mt=new class extends st{#N=null;constructor(t){let{commentsApiService:e}=t;super(),this.#N=e}async getFilmComments(t){return await this.#N.getFilmComments(t)}async addComment(t,e){try{this.#N.addComment(e.id,e.commentToAdd),delete e.commentToAdd,this._notify(t,e)}catch(t){throw new Error("Can't add comment")}}async deleteComment(t,e){try{this.#N.deleteComment(e.commentToDelete.id),delete e.commentToDelete,this._notify(t,e)}catch(t){throw new Error("Can't delete comment")}}}({commentsApiService:new class extends rt{async getFilmComments(t){return this._load({url:`comments/${t}`}).then(rt.parseResponse)}async addComment(t,e){const n=await this._load({url:`comments/${t}`,method:"POST",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})});return await rt.parseResponse(n)}async deleteComment(t){return await this._load({url:`comments/${t}`,method:"DELETE"})}}(ot,lt)}),dt=new class extends st{#q=k;get filter(){return this.#q}setFilter(t,e){this.#q=e,this._notify(t,e)}},ht=new class{#J=new j;#Z=new R;#z=new O;#K=new tt;#V=null;#X=null;#G=null;#Q=null;#h=null;#tt=null;#d=null;#et=null;#nt=new Map;#it=null;#n=A;#st=!0;constructor(t){let{filmsContainer:e,filmsModel:n,commentsModel:i,filterModel:s}=t;this.#Q=e,this.#h=n,this.#tt=i,this.#d=s,this.#h.addObserver(this.#f),this.#d.addObserver(this.#f),this.#tt.addObserver(this.#f)}get films(){const t=this.#d.filter,e=this.#it.filters[t].filteredFilms;switch(this.#n){case D:return e.sort(((t,e)=>H(e.filmInfo.release.date,x)-H(t.filmInfo.release.date,x)));case F:return e.sort(((t,e)=>e.filmInfo.totalRating-t.filmInfo.totalRating));default:return e}}get comments(){return this.#tt.comments}init(){this.#rt(),this.#lt(),this.#ot(),this.#at(),this.renderFilms(5),this.#ct()}clearFilmList(){let{resetSortType:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.#nt.forEach((t=>t.destroy())),this.#nt.clear(),g(this.#G),this.#ct(),t&&(this.#n=A,this.#mt(this.#X.element.querySelector('.sort__button[data-sort-type="default"]')))}renderFilms(t){if(this.#st)return void this.#dt();const e=this.films;if(!e.length){g(this.#G);const t=this.#et;return this.#et=new nt({filters:this.#it.filters,activeFilter:this.#d.filter}),null===t||g(t),void C(this.#et,this.#Q)}null!==this.#et&&g(this.#et);const n=this.#z.element.children.length;for(let i=n;i<n+t;i++)if(this.#ht(e[i]),e[i]===e[e.length-1])return void g(this.#G)}#lt(){const t=this.#it.filters.history.filteredFilms.length,e=this.#V;this.#V=new et({watchedFilmsCount:t}),null!==e?(C(this.#V,it),y(this.#V,e),g(e)):C(this.#V,it)}#dt(){C(this.#K,this.#Z.element,"afterbegin")}#ht(t){const e=new Q({filmListContainer:this.#z.element,onDataChange:this.#ut});this.#tt.getFilmComments(t.id).then((n=>{e.init({...t,comments:n})})),this.#nt.set(t.id,e)}#rt(){this.#it=new N({filtersContainer:this.#Q,filterModel:this.#d,filmsModel:this.#h}),this.#it.init(),this.#lt()}#ot(){this.#X=new Y({onSortTypeChange:this.#e,currentSortType:this.#n}),C(this.#X,this.#Q)}#at(){C(this.#J,this.#Q),C(this.#Z,this.#J.element),C(this.#z,this.#Z.element)}#ct(){this.#G=new U({onClick:this.#ft}),C(this.#G,this.#Z.element)}#mt(t){this.#X.element.querySelector(".sort__button--active").classList.remove("sort__button--active"),t.classList.add("sort__button--active")}#e=(t,e)=>{this.clearFilmList(),this.#n=e,this.#mt(t),this.renderFilms(5)};#ft=()=>{this.renderFilms(5)};#ut=(t,e,n)=>{switch(t){case w:this.#h.updateFilm(e,n);break;case $:this.#h.updateFilm(e,n),this.#tt.addComment(e,n);break;case M:this.#h.updateFilm(e,n),this.#tt.deleteComment(e,n)}};#f=(t,e)=>{switch(this.#lt(),t){case b:this.#tt.getFilmComments(e.id).then((t=>{this.#nt.get(e.id).init({...e,comments:t})}));break;case S:this.clearFilmList(),this.renderFilms(5);break;case T:this.clearFilmList({resetSortType:!0}),this.renderFilms(5);break;case E:this.#st=!1,g(this.#K),this.renderFilms(5)}}}({filmsContainer:at,filmsModel:ct,commentsModel:mt,filterModel:dt});ht.init(),ct.init()})()})();
//# sourceMappingURL=bundle.js.map